
---
#
# install curator tool for managing elasticsearch
#

- name: Copy curator yum repo file
  copy:
    src=curator.repo
    dest=/etc/yum.repos.d/curator.repo
    owner=huqadmin
    group=wheel
    mode=0644
  become: true
  when: install_curator_tool

- name: Import curator GPG Key
  rpm_key: key=http://packages.elastic.co/GPG-KEY-elasticsearch
    state=present
  when: install_curator_tool

- name: Install curator and python-setuptools
  yum: name={{ item }} state=present
  become: true
  with_items:
    - python-elasticsearch-curator
    - python-setuptools
  when: install_curator_tool

- name: Install curator config
  copy:
    src=cfg.yml
    dest=/home/huqadmin/cfg.yml
    owner=huqadmin
    group=wheel
    mode=0644
  become: true


- name: Install curator action file
  copy:
    src=af.yml
    dest=/home/huqadmin/af.yml
    owner=huqadmin
    group=wheel
    mode=0644
  become: true


- name: Set up daily cron job
  copy:
    src=curate.cron
    dest=/etc/cron.daily/curate.cron
    owner=huqadmin
    group=wheel
    mode=0644
  become: true
